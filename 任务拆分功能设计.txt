任务拆分功能设计
1. 概述
任务拆分功能是“WP Daily Manager”插件的核心特性，允许用户将大目标或任务动态分解为无限层级的子任务，每层任务可定义目标（数字或描述）、时间（日期/时间段/重复规则）以及状态/反馈。任务拆分支持从顶层（如“赚钱”）到最底层的具体行动（如“1月15日14:00-16:00设计封面”），并与类别（可自定义，三级嵌套）结合使用。
2. 功能目标
动态嵌套：支持无限层级的任务分解，用户可随时为任何任务添加子任务。
灵活性：支持数字目标（如“储蓄10万”）和非数字目标（如“写小说”）。
时间管理：每层任务可绑定具体时间（如日期、时间段）或重复规则（如每日/每周/每月）。
反馈与进度：每层任务支持状态（待办/进行中/完成）和进度跟踪（如完成比例）。
用户体验：提供直观提示和编辑界面，支持前后台操作。

3. 功能设计
3.1 任务拆分规则
层级结构：
任务通过parent_id字段形成树状结构，顶层任务parent_id为空，子任务指向父任务的id。
示例：从“赚钱”（顶层） → “每天工作8小时”（一级子任务） → “设计封面”（二级子任务） → “草稿/上色”（三级子任务）。
拆分方式：
手动拆分：用户输入子任务的描述、目标和时间。
跳过拆分：用户选择不进一步拆分当前任务，直接保存。
重复任务拆分：支持重复性任务（如“每天工作8小时”），自动生成每日/每周/每月记录（用户可手动调整）。
3.2 拆分流程
3.2.1 后台任务创建与拆分
入口：
在WordPress后台“日常管理” → “任务管理”页面，点击“添加任务”或编辑现有任务。
步骤：
输入顶层任务：
填写任务标题（如“赚钱”）、类别（从category表选择，如“工作”）、类型（“long-term”/“daily”）、目标（如“50万”）、时间范围（如2025年1月-12月）。
保存至tasks表，parent_id为空。
添加子任务：
点击“添加子任务”按钮，弹出表单：
标题（如“每天工作8小时”）。
目标（如“8小时”）。
时间/重复规则：
单次：选择start_time和end_time（如“1月15日14:00-16:00”）。
重复：选择repeat_type（daily/weekly/monthly），输入repeat_detail（如“每日9:00-17:00”）。
状态（默认“pending”）。
备注（可选）。
保存子任务至tasks表，parent_id指向父任务id。
继续嵌套：
为“每天工作8小时”添加子任务（如“设计封面”），重复上述步骤。
支持无限层级，直到用户选择“跳过”或完成拆分。
提示与验证：
系统提示：“是否继续拆分此任务？”选项包括“手动拆分”“跳过”。
验证repeat_detail格式（如“每周一 10:00”）。
示例：
创建“赚钱”（id=1，category_id=工作）。
添加“每天工作8小时”（id=2，parent_id=1，repeat_type=daily，repeat_detail=每日9:00-17:00）。
添加“设计封面”（id=3，parent_id=2，start_time=2025-01-15 14:00，end_time=16:00）。
添加“草稿”（id=4，parent_id=3，start_time=14:00，end_time=15:00）。
3.2.2 前台微调与展示
微调：
用户可在前台通过短代码（如[wpdm_tree]）查看任务，点击“编辑”调整子任务：
修改时间（如14:00 → 15:00）。
更改目标（如“设计封面”改“设计海报”）。
标记状态（如“completed”）。
添加新子任务（动态嵌套）。
展示：
树状视图：按嵌套关系显示（如“赚钱” → “每天工作8小时” → “设计封面” → “草稿”），支持折叠/展开。
日历视图：按时间显示（如1月15日14:00-15:00“草稿”）。
甘特图：层次展开显示时间范围（如“赚钱”1月-12月，“设计封面”1月15日）。
列表视图：按时间排序（如1月15日14:00“草稿”）。
3.3 时间管理
时间绑定：
每层任务支持：
具体日期/时间段（如“2025-01-15 14:00-16:00”）。
重复规则（如“每日9:00-17:00”“每周一 10:00”“每月15日 14:30”）。
提示规则：
每周任务：显示“每周几，几点”（如“每周一 10:00”）。
每日任务：显示“每日几点”（如“每日 19:00”）。
每月任务：显示“每月几日，几点几分”（如“每月15日 14:30”）。
单次任务：显示具体时间（如“1月15日 14:00-16:00”）。
实现：
repeat_type和repeat_detail字段存储规则。
前台用AJAX解析，生成提醒。
3.4 目标与反馈
目标类型：
数字目标：如“储蓄10万”，拆分至每月/每周值。
非数字目标：如“写小说”，拆分为阶段性任务（如“写第1章”）。
反馈：
状态：每层任务支持“pending”“in-progress”“completed”。
进度：
数字目标：完成值/总量（如“储蓄3万/10万 = 30%”）。
非数字目标：子任务完成比例（如“写小说”完成3/10章 = 30%）。
自动汇总：子任务完成 → 父任务进度更新。
3.5 类别关联
功能：
任务拆分时选择类别（从category表中选择或自定义）。
支持三级嵌套（如“生活” → “财务” → “储蓄”）。
实现：
tasks.category_id引用category.id。
后台类别管理界面展示树状结构，限制level≤3。

4. 用户交互设计
4.1 后台界面
任务拆分表单：
标题输入框、类别下拉（动态加载category表）。
类型选择（长期/日常）。
目标输入（数字或文本）。
时间选择（日期/时间段/重复规则）。
“添加子任务”按钮，弹出子任务表单。
提示：
“是否继续拆分？”弹出框，提供“手动”“跳过”选项。
验证时间格式（如“每周一 10:00”）。
4.2 前台界面
视图切换：
下拉菜单选择“日历”“甘特”“列表”“树状”，默认每日日程。
交互：
点击任务展开子任务或编辑。
标记完成，AJAX更新status。

5. 技术实现
5.1 数据存储
使用$wpdb操作wp_wpdm_tasks表：
插入：wpdm_save_task($data)，保存至tasks表。
查询：wpdm_get_tasks($parent_id, $category_id)，按嵌套和类别筛选。
类别管理：wpdm_save_category($data)，确保level≤3。
5.2 前端交互
日历：用FullCalendar.js加载tasks数据。
甘特图：用Frappé Gantt，动态查询嵌套任务。
树状：用jQuery或React渲染树状结构。
通知：用wp_schedule_event定时检查，AJAX弹窗。
